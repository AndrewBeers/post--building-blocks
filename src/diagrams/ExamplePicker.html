<:Window bind:scrollY='scrollY'/>

<div id="example-picker" style="position: {{scrollY >= 570 ? 'fixed': 'absolute'}};
  top: {{scrollY >= 570 ? 20 : 0}}px;">
  {{#each examples as ex}}
  <img src="examples/{{ex}}.png" alt="{{ex}}" 
    class="{{selected === ex ? 'selected' : ''}}" 
    on:click="set({selected: ex})" />
  {{/each}}
</div>

<style>
  #example-picker {
    width: 44px;
    margin-left: -90px;
  }

  #example-picker img {
    width: 44px;
    cursor: pointer;
    opacity: 0.4;
    border: 3px solid #fff;
    border-radius: 7px;
  }

  #example-picker img.selected {
    opacity: 1;
    border-color: #3497FF;
  }

  #example-picker img:hover { 
    opacity: 1;
    border-color: #ff6600;
  }
</style>

<script>
  import { setDeep } from 'svelte-extras';
  import { argmax } from 'ndarray-ops';

  export default {
    data() {
      return {
        activations: {},
        magnitudes: {}
      };
    },

    oncreate() {
      const examples = require('../../static/examples/index.json');
      for (const ex of examples) {
        require(`../../static/examples/${ex}_mixed4d.npy`)
          .load((act) => this.setDeep('activations.' + ex, act));
        require(`../../static/examples/${ex}_mixed4d_magnitude.npy`)
          .load((mag) => this.setDeep('magnitudes.' + ex, mag));
      }
    },

    computed: {
      examples: (activations) => Object.keys(activations),
      selected: (examples) => examples[0],
      act: (selected, activations) => activations[selected],
      max_act: (act) => act && act.get(...argmax(act))
    },

    methods: { setDeep }
  }
</script>